<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript">
		output ={};
		function dummyCreator(){
			var data={"Show":{"CIM.Light.Data.Light":null},"DelResponseData":{"key":"Message.Value.Show.Result.LightDef.Action","Value":"all"}}
			var http = new XMLHttpRequest();
			var url = "http://localhost:8080/fid-CIMQueryInterface?SensorCustomerKey=CDP-All&AppKey=CDP-App&UserKey=CDP-User";
			var params = "SensorCustomerKey=CDP-All&AppKey=CDP-App&UserKey=CDP-User";
			http.open("POST", url, true);

					//Send the proper header information along with the request
					http.setRequestHeader("Content-type", "application/json");

					http.onreadystatechange = function(){//Call a function when the state changes.
						if(http.readyState == 4 && http.status == 200){
							http.responseText;
							var res =http.responseText;
							res=JSON.parse(res);
                            console.log("result :",res)
                            
							f(res,"Show",output);

							console.log("output :"+JSON.stringify(output));
						}

					}
					http.send(JSON.stringify(data));
				}

                f=function(root, label, op){
				console.log('abc',root,label,op,typeof(root))
		
                for (x in root) {
                    
                    
                        





						switch (x){

							case "Double" :
							f(root[x],lable,op[label]) ;
							break;								

							case "String" :
							f(root[x],label,op[label]) ;
							break;

							case "DateTime" : 
							f(root[x],label,op[label]) ;
							break;

							case "Boolean" :
								f(root[x],label,op[label]) ;
							break;


							case "Number" :
							f(root[x],label,op[label]) ;
							break;

							case "Name" : 
							if(!ignore){
								if(cardinality){
									//console.log("cardinality ::" )
							        output[root[x]]=Array(len);  
							        //console.log() 				     		
								    cardinality=false;
								}
							    else if(format){
                                       
                                    output[root[x]]={ };
                                    format=false;
							    }
							    else{
                                    output[root[x]]=root[x];
							    }
							}
							else {
								ignore=false;
							}
							break;

							case "Cardinality" :


							if(typeof(root[x])=='object'){
								len=root[x].length;   

								if( root[x][len-1][0] ==1){
									len=2 ;
								} 
								else if(root[x][len-1][0] ==0){
									len=1; 
								}
							}
							else if(root[x].length==1){
								len=1;
							}else if(root[x][0]==1){
								len=2;
							}
                             cardinality=true;
                             break;
                             
                            case "Format":
                              if(x=="Format" && root[x].includes("objectFormat")){
                                 format=true;
                              }
                              else {
                              	format=false;
                              }
                             break;

							default :


							if(typeof(root[x]) == 'object'){
								if(x=="Default" || x=="ReadOnly" || x=="Constant" || x=="Eq" ) { 
                                           ignore=true;  
                                           if(cardinality==true){
                                           	cardinality=false;
                                           }                      	 
                                       }
                                       else {
					                 	f(root[x]);  
					                 }
					             }

                                 else {
                                	if(x=="Default" || x=="ReadOnly" || x=="Constant" || x=="Eq" || x=="Transient") { 
                                        ignore=true;                             	 
                                        if(cardinality==true){
                                        	cardinality=false;
                                        }
                                	 }
                                     
                                }

                  if(label !='String' ||label!='Number' ||label!='Double' || label!='DateTime' ){
					if((typeof(root[label]))=='object'){
						op[label]={};
						cur=root[label];
						for ( y in cur){
							f(cur,y,op[label]);
							console.log("y :"+y)
							val=label;
						}
					} 
					else {	
						console.log('Non object found: '+label);
						op[label]=root[label];
						
					
					}
				}
				else {
					for (a in root[label]){
						console.log("inside array", "root ",root[label][a],"label",root[label]);
                         arrItr=true;   
				         for(b in root[label][a]){
				            //console.log("attribute in array : ",b,"Value:",root[label][a][b]);
				            val=root[label][a][b];
				            //console.log(" rootect to  pass : ",root[label][a],"label");
				            
				            console.log("label: "+JSON.stringify(op));
				            op[root[label][a][b]]=root[label][a][b];
				            f(root[label][a],"Name",op[val]); 	
				         }
						
						//op[root[label][a]]=root[label][a]
					}
					arrItr=false;
				}                                                          							   
                                
                    break;					   					 
                }

            }
				
			}
			
         dummyCreator();
         console.log("output :"+JSON.stringify(output));
			</script>
		</head>
		<body>

		</body>
		</html>

