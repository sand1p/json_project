	<!DOCTYPE html>
	<html>
	<head>
		<!-- <script type="text/javascript" src="C:\inetpub\wwwroot\cdp\backup\script.js"> </script> -->
		<title>Json Parser</title>
		<script type="text/javascript">


			if( typeof Array.isArray !== 'function' ) {
				Array.isArray = function( arr ) {
					return Object.prototype.toString.call( arr ) === '[object Array]';
				};

			}
			function getParameterByName(name, url) {
				if (!url) {
					url = window.location.href;
				}
				name = name.replace(/[\[\]]/g, "\\$&");
				var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
				results = regex.exec(url);
				if (!results) return null;
				if (!results[2]) return '';
				return decodeURIComponent(results[2].replace(/\+/g, " "));
			}


			modelName=getParameterByName("firstname",window.location.search);
			console.log("modelName:",modelName)
			output={"create": { } };
			len=0;
			val="";
			dataValue="";
			nameVal=Array(15);
			index=0;
			objectFormat=false;
			cardinality=false;
			ignore=false;
			function dummyCreator(){
				var data={};

				data["Show"]={};
				data["Show"][modelName]=null;
				data["SetResponse"]={};
				data["SetResponse"]["Message"]={};
				data["SetResponse"]["Message"]["Value"]={}
				data["SetResponse"]["Message"]["Value"]["Include"]="$Response.Message.Value.Show.Result/*/*[name()!='Action']"
				JSON.stringify(data);

				console.log("data :", data);
				var http = new XMLHttpRequest();
				var url = "http://localhost:8080/fid-CIMQueryInterface?SensorCustomerKey=CDP-All&AppKey=CDP-App&UserKey=CDP-User";
				var params = "SensorCustomerKey=CDP-All&AppKey=CDP-App&UserKey=CDP-User";
				http.open("POST", url, true);

						//Send the proper header information along with the request
						http.setRequestHeader("Content-type", "application/json");

						http.onreadystatechange = function(){//Call a function when the state changes.
							if(http.readyState == 4 && http.status == 200){
								http.responseText;
								var res =http.responseText;
								res=JSON.parse(res);
								console.log("res : "+res)
								console.log("result :",JSON.stringify(res))
								iterate(res,"Show",output["create"]);
								console.log("output :"+JSON.stringify(output));
							}

						}
						http.send(JSON.stringify(data));
					}

					function iterate(root,label,op){
						console.log("label : ",label );
						for(x in root){
							console.log("values of x :"+ x ) 

							if(x=="Default" || x=="ReadOnly" || x=="Constant" || x=="Eq" || x=="Transient" || (typeof(x)=='Number')){

								cardinality=false;
								ignore=true;
								continue;
							}
							if(x =='Cardinality'){
								if(Array.isArray(root[x])){
									len=root[x].length;   

									if( root[x][len-1][0] ==1){
										len=2 ;
									} 
									else if(root[x][len-1][0] ==0){
										len=1; 
									}
								}
								else if(root[x].length==1){
									len=1;
								}else if(root[x][0]==1){
									len=2;
								}else {
									len=1
								}
								cardinality=true;

							}
							else if(x=='Format') {
								if(root[x].includes("ObjectFormat")){
									objectFormat=true;
								}
								else {
									objectFormat=false;
								}
							}
							else if(x=='String' || x=='Double' || x=='Number'|| x=='Boolean' ||x=='DateTime'){
								console.log("x : ", x," root[x] : ",root[x] )
								val=x;
								if(val=='Double'){
									dataValue=45.454;
								}else if(val=='Number'){
									dataValue=345
								}
								else if(val=='Boolean'){
									dataValue=true;  
								}else if(val=='DateTime'){
									dataValue="[:$Now():]";
								}
								if(Array.isArray(root[x])){
									n=root[x].length;
									val=x;
									//console.log("in Array : x :" , x, " root[x] " ,root[x])
									for(i=0;i<n;i++){	
										console.log("all objects inside literals :",root[x][i]);								      
										iterate(root[val][i],label,op);
									}
								}
								else if(Object.prototype.toString.call(root[x])==='[object Object]'){
									iterate(root[x],label,op);
								}

							}
							else if(x=='Name'){
								if(!ignore && !nameVal.includes(root[x])){
									if(cardinality){
										arr=Array(len)
										for(j=0;j<len;j++){
											arr[j]="key";
										}  
										op[root[x]]=arr;
										cardinality=false;
									}else if(objectFormat){
										op[root[x]]={"key":"value"};
										objectFormat=false;
									}else{ 
										
										if(val=='String'){
											op[root[x]]=root[x];
										}else {

											op[root[x]]=dataValue;
										}

									}
								}
								else{
									ignore=false;
								}
							}
							else if(Object.prototype.toString.call(root[x]) ==='[object Object]'){
								if(root[x].Name!='undefined'){
									op[root[x].Name]={};
									nameVal[index]=root[x].Name;
									index++;
									iterate(root[x],root[x].Name,op[root[x].Name])
								}
							}else if(Array.isArray(root[x])){
								m=root[x].length;
								valx=x;
								for(j=0;j<m;j++){
									console.log("array values : ",root[valx][j]);
									iterate(root[valx][j],label,op)
								}
							}
						}
					}	
					dummyCreator()
				</script>
			</head>
			<body>
			</body>
			</html>
